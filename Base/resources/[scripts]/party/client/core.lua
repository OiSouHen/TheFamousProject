-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRP = Proxy.getInterface("vRP")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
vSERVER = Tunnel.getInterface("party")
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Open = false
-----------------------------------------------------------------------------------------------------------------------------------------
-- PARTYS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("Partys",function()
	local Ped = PlayerPedId()
	if not Open and not IsPedInAnyVehicle(Ped) then
		Open = true
		SetNuiFocus(true,true)
		SendNUIMessage({ Action = "Open", Payload = { LocalPlayer["state"]["Passport"],vSERVER.GetRooms() } })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- DISPLAYS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterCommand("Displays",function()
	Display = not Display

	if Display then
		TriggerEvent("Notify","Grupos","Nome dos participantes ativado.","verde",5000)
	else
		TriggerEvent("Notify","Grupos","Nome dos participantes desativado.","vermelho",5000)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- KEYMAPPING
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterKeyMapping("Partys","Abrir os grupos","keyboard","G")
RegisterKeyMapping("Displays","Mostrar/Esconder membros do grupo","keyboard","I")
-----------------------------------------------------------------------------------------------------------------------------------------
-- GETROOMS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("GetRooms",function(Data,Callback)
	Callback(vSERVER.GetRooms())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- GETMEMBERS
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("GetMembers",function(Data,Callback)
	Callback(vSERVER.GetMembers(Data["Id"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- LEAVEROOM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("LeaveRoom",function(Data,Callback)
	Callback(vSERVER.LeaveRoom())
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CREATEROOM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("CreateRoom",function(Data,Callback)
	Callback(vSERVER.CreateRoom(Data["Name"],Data["Password"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- KICKROOM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("KickRoom",function(Data,Callback)
	Callback(vSERVER.KickRoom(Data["Room"],Data["Passport"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- ENTERROOM
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("EnterRoom",function(Data,Callback)
	Callback(vSERVER.EnterRoom(Data["Room"],Data["Password"]))
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("Close",function(Data,Callback)
	SetNuiFocus(false,false)
	Open = false

	Callback("Ok")
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- PARTY:RESETNUI
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNetEvent("party:ResetNui")
AddEventHandler("party:ResetNui",function()
	if Open then
		Open = false
		SetNuiFocus(false,false)
		SendNUIMessage({ Action = "Close" })
	end
end)